#!/usr/bin/env python3
# coding=utf-8

from __future__ import absolute_import, print_function

import pandas as pd
import numpy as np
import PyQt5 # for Mayavi
from mayavi import mlab
import utils
import pickle
import argparse
PC_RANGE = [-69.12, -69.12, -1, 69.12, 69.12, 7]

if __name__ == '__main__':
    dataset_path = "/media/ganoufa/GAnoufaSSD/datasets/generated_datasets/unigineClass0/"
    parser = argparse.ArgumentParser()
    parser.add_argument('index', type=int, help="index")
    args = parser.parse_args()
    sample_idx = args.index
    
    pc_path = dataset_path + "lidar/" + str(sample_idx) + ".npy"
    info_path = dataset_path +  "unigine_infos_train.pkl"
    with open(info_path, 'rb') as pickle_file:
        info = pickle.load(pickle_file)
    pc = utils.load_pc(pc_path)
    # valid_idx = (pc[:, 0] >= PC_RANGE[0]) & (pc[:, 0] < PC_RANGE[3]) & (pc[:, 1] >= PC_RANGE[1]) & (pc[:, 1] < PC_RANGE[4]) & (pc[:, 2] >= PC_RANGE[2]) & (pc[:, 2] < PC_RANGE[5])
    # pc = pc[valid_idx, :]

    boxes = {}
    boxes['50'] = [[ 27.6992, -20.5764,   1.0335,   3.0389,   2.9752,   1.9727,   1.3922,
            1.0000],
         [ 23.1216, -18.5230,   0.6135,   2.5196,   2.4877,   1.3498,   1.3922,
            1.0000],
         [ 18.3685, -11.7993,   0.9408,   7.6967,   6.6602,   2.5060,   1.3922,
            1.0000]]
    boxes['165'] = [[ 30.8974,  24.6767,   0.3928,   2.5882,   2.5780,   0.6318,   2.9181,
            1.0000],
         [ 20.7705,  17.7374,   4.7085,   5.6840,   5.4874,  10.2346,   2.9181,
            1.0000],
         [  0.0000,   0.0000,   0.0000,   0.0000,   0.0000,   0.0000,   0.0000,
            0.0000]]
    boxes['7'] = [[ 21.9132,  13.6571,   0.4631,   0.9791,   0.9613,   0.9014,  -2.9018,
            1.0000],
         [ 17.5538,  13.2038,   0.6692,   2.1490,   2.2900,   1.4261,  -2.9018,
            1.0000],
         [  9.2807,  19.0304,   1.1859,   4.8206,   5.6334,   2.4069,  -2.9018,
            1.0000]]

    boxes['30'] = [[ 32.4964, -29.1947,   0.7724,   3.9964,   4.2508,   1.5935,   0.8751,
            1.0000],
         [ 36.4010, -27.0595,   0.3103,   2.1515,   2.1618,   0.6526,   0.8751,
            1.0000],
         [ 30.1030, -27.6147,   5.0740,   4.5914,   2.2851,  10.6054,   0.8751,
            1.0000],
         [ 27.5274, -31.1920,   1.0673,   4.7145,   3.6165,   2.1837,   0.8751,
            1.0000]]

    boxes['35'] = [[ -0.0983,   1.0129,   0.4762,   0.8647,   0.8684,   0.8618,  -2.0667,
            1.0000],
         [ -0.9956,   4.1365,   0.7791,   1.9188,   1.6592,   1.3547,  -2.0667,
            1.0000],
         [ -1.6667,   6.0932,   4.2778,   3.1490,   4.5900,   9.5283,  -2.0667,
            1.0000],
         [ -8.3610,  -1.5362,   1.1017,   4.9879,   3.8735,   2.2788,  -2.0667,
            1.0000]]

    boxes['6'] = [[  9.4540,  10.3968,   1.2607,   5.6921,   5.3685,   2.4160,  -2.6261,
            1.0000],
         [ 26.1430,   6.5756,   0.7696,   3.1712,   4.0293,   1.5650,   2.1327,
            1.0000],
         [  0.0000,   0.0000,   0.0000,   0.0000,   0.0000,   0.0000,   0.0000,
            0.0000],
         [  0.0000,   0.0000,   0.0000,   0.0000,   0.0000,   0.0000,   0.0000,
            0.0000]]

    boxes['125'] = [[ 32.4867,   1.2497,   1.0950,   5.4851,   5.0394,   2.1491,   1.0661,
            1.0000],
         [ 27.8849, -10.5183,   4.2784,   1.0615,   1.0855,   9.9945,   0.6416,
            1.0000]]
    
    boxes['102'] =[[ 39.1578,  -1.1024,   0.7573,   2.0696,   2.0090,   1.4058,   2.3033,
            1.0000],
         [ 29.7581,   0.6235,   0.8740,   6.0549,   5.9999,   2.1779,   2.3033,
            1.0000]]
    boxes['110'] = [[  9.3401,   1.7839,   1.0556,   3.1899,   3.2384,   2.0554,  -2.4885,
            1.0000],
         [ 16.7403,   3.3772,   1.0526,   3.0056,   2.9413,   2.0616,  -2.5196,
            1.0000]]
    
    boxes['492'] = [[ 4.19153756e+01, -6.88255309e+00,  5.24411756e+00,
         4.47510899e+00,  2.64386643e+00,  1.04487998e+01,
        -8.02383082e-03],
       [ 4.44386084e+01,  6.68237878e+00,  1.65881913e+00,
         4.16673638e+00,  4.21937003e+00,  3.72939331e+00,
        -8.02382874e-03],
       [ 5.59273312e+01, -4.36884910e+00,  1.42664147e+00,
         4.40844079e+00,  2.38053179e+00,  2.32308948e+00,
        -8.02383145e-03]]
    fig = mlab.figure('pc', size=(1440, 810), bgcolor=(0.05, 0.05, 0.05))

    # draw gt
    for box in boxes[str(sample_idx)]:
        fig = utils.draw_gt_box(utils.boxToCorners(box), fig, color=(1, 0,0))

    vis= mlab.points3d(pc[:, 0], pc[:, 1], pc[:, 2], pc[:, 3], mode='point', figure=fig)
    mlab.view(distance=25)
    mlab.show()
    
    

